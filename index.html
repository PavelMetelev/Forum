<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Отбитые Парни Форум</title>
  <meta name="description" content="Отбитые Парни Форум — место, где панк, шум и честные разговоры встречаются лицом к лицу." />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rubik+Mono+One&family=JetBrains+Mono:wght@300;400;600;800&display=swap" rel="stylesheet">

  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

  <style>
    :root {
      color-scheme: dark;
    }

    body {
      font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      background:
        radial-gradient(circle at 0% 0%, rgba(236, 72, 153, 0.28), transparent 55%),
        radial-gradient(circle at 100% 100%, rgba(52, 211, 153, 0.25), transparent 50%),
        radial-gradient(circle at 0% 100%, rgba(59, 130, 246, 0.2), transparent 55%),
        #020617;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }

    body::before {
      content: "";
      position: fixed;
      inset: -50px;
      pointer-events: none;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="160" height="160" viewBox="0 0 160 160"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="1.2" numOctaves="3" stitchTiles="no"/></filter><rect width="100%" height="100%" filter="url(%23n)" opacity="0.32"/></svg>');
      mix-blend-mode: soft-light;
      z-index: -1;
    }

    .punk-title {
      font-family: "Rubik Mono One", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .punk-outline {
      text-shadow:
        2px -2px 0 #22c55e,
        -2px 2px 0 #e11d48,
        0 0 18px rgba(248, 250, 252, 0.18);
    }

    .punk-card {
      background: radial-gradient(circle at 0 0, rgba(248, 250, 252, 0.09), transparent 55%), rgba(15, 23, 42, 0.96);
      border: 1px solid rgba(148, 163, 184, 0.35);
      box-shadow:
        0 0 0 1px rgba(15, 23, 42, 0.7),
        0 18px 45px rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(8px);
    }

    .punk-card-ghost {
      background: linear-gradient(135deg, rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.4));
      border: 1px dashed rgba(148, 163, 184, 0.5);
    }

    .badge-outline {
      border: 1px dashed rgba(248, 250, 252, 0.6);
    }

    .glitch-line {
      position: absolute;
      height: 1px;
      width: 100%;
      background: linear-gradient(90deg, transparent, rgba(236, 72, 153, 0.9), rgba(34, 197, 94, 0.9), transparent);
      opacity: 0.45;
      mix-blend-mode: screen;
      pointer-events: none;
      animation: scan 8s linear infinite;
    }

    .glitch-line:nth-child(2) {
      animation-delay: -3s;
      opacity: 0.22;
    }

    @keyframes scan {
      0% { transform: translateY(-5%); }
      100% { transform: translateY(105%); }
    }

    .scrollbar-thin::-webkit-scrollbar {
      width: 6px;
    }

    .scrollbar-thin::-webkit-scrollbar-track {
      background: transparent;
    }

    .scrollbar-thin::-webkit-scrollbar-thumb {
      background: rgba(148, 163, 184, 0.55);
      border-radius: 999px;
    }

    .scrollbar-thin::-webkit-scrollbar-thumb:hover {
      background: rgba(248, 250, 252, 0.9);
    }

    .js-category-btn-active {
      background-color: rgb(15 23 42 / 0.9);
      border-color: rgb(236 72 153 / 0.7);
      color: rgb(251 244 252);
      box-shadow: 0 0 20px rgba(236, 72, 153, 0.7);
    }
  </style>
</head>
<body class="text-slate-100">
  <div class="glitch-line"></div>
  <div class="glitch-line"></div>

  <div class="min-h-screen flex flex-col">
    <!-- Top banner -->
    <header class="border-b border-pink-600/40 bg-black/50 backdrop-blur-md sticky top-0 z-30">
      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between">
        <div class="flex items-center gap-4">
          <div class="relative h-12 w-12 flex items-center justify-center rounded-full bg-gradient-to-br from-pink-500 via-emerald-400 to-sky-500 shadow-[0_0_40px_rgba(236,72,153,0.9)]">
            <span class="absolute inset-0 rounded-full border border-white/40 border-dashed animate-pulse"></span>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-7 h-7 text-slate-900">
              <path fill="currentColor" d="M12 2C8.134 2 5 5.134 5 9v2.126C3.763 11.57 3 12.698 3 14c0 1.657 1.343 3 3 3h.5a2.5 2.5 0 0 0 2.45 2H10v-3H8.5c-.276 0-.5-.224-.5-.5V14h8v1.5c0 .276-.224.5-.5.5H14v3h1.05A2.5 2.5 0 0 0 17.5 17H18c1.657 0 3-1.343 3-3 0-1.302-.763-2.43-2-2.874V9c0-3.866-3.134-7-7-7m-4 7h2v2H8zm6 0h2v2h-2z" />
            </svg>
          </div>
          <div>
            <div class="flex items-center gap-3">
              <h1 class="punk-title punk-outline text-xl sm:text-2xl text-slate-50 tracking-[0.3em] leading-tight">
                ОТБИТЫЕ ПАРНИ ФОРУМ
              </h1>
              <span class="hidden sm:inline-flex items-center px-2.5 py-1 rounded-full text-[10px] font-semibold uppercase tracking-[0.2em] bg-pink-600/15 text-pink-300 border border-pink-500/60">
                Live 24/7
              </span>
            </div>
            <p class="mt-1 text-xs sm:text-sm text-slate-300/80 max-w-xl">
              Полуночные крики, битые струны и честные разговоры. Никакого глянца — только настоящий панк.
            </p>
          </div>
        </div>

        <div class="flex flex-wrap items-center gap-3 text-[11px] sm:text-xs">
          <div class="inline-flex items-center gap-1 rounded-full px-3 py-1 badge-outline bg-slate-900/70">
            <span class="text-pink-400 font-bold text-[11px]">18+</span>
            <span class="text-slate-300/80">мат, шум и мнения на свой страх и риск</span>
          </div>
        </div>
      </div>

      <!-- Nav -->
      <nav class="border-t border-slate-700/80 bg-slate-950/80">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 flex flex-wrap items-center gap-2 py-2 text-xs">
          <div class="flex flex-wrap gap-1.5">
            <button id="navHomeBtn" class="px-3 py-1 rounded-full bg-pink-600 text-slate-950 font-semibold uppercase tracking-[0.16em] text-[11px] shadow-[0_0_18px_rgba(236,72,153,0.8)] flex items-center gap-1.5">
              <span class="w-1.5 h-1.5 bg-slate-950 rounded-full"></span>
              Главная помойка
            </button>
            <button id="navThreadsBtn" class="px-3 py-1 rounded-full bg-slate-900 text-slate-200 border border-slate-600/80 uppercase tracking-[0.16em] text-[11px]">Темы</button>
            <button id="navMembersBtn" class="px-3 py-1 rounded-full bg-slate-900 text-slate-200 border border-slate-600/80 uppercase tracking-[0.16em] text-[11px]">Участники</button>
            <button id="navAboutBtn" class="px-3 py-1 rounded-full bg-slate-900 text-slate-200 border border-slate-600/80 uppercase tracking-[0.16em] text-[11px]">О нас</button>
          </div>
          <div class="ml-auto flex items-center gap-2">
            <button id="themeToggle" class="flex items-center gap-1.5 px-3 py-1 rounded-full border border-slate-600/80 bg-slate-900/90 text-[11px] uppercase tracking-[0.16em]">
              <span class="w-2 h-2 rounded-full bg-sky-400"></span>
              Неон / Тьма
            </button>
            <button id="newThreadBtn" class="flex items-center gap-1.5 px-3 py-1 rounded-full bg-emerald-400 text-slate-950 font-semibold uppercase tracking-[0.16em] text-[11px] shadow-[0_0_20px_rgba(16,185,129,0.9)]">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-3.5 h-3.5">
                <path fill="currentColor" d="M19 3H5a2 2 0 0 0-2 2v12c0 1.103.897 2 2 2h7v-2H5V7h14v3h2V5a2 2 0 0 0-2-2m-3.293 9.293l-4.293 4.293V19h2.414l4.293-4.293z" />
              </svg>
              Новая тема
            </button>
          </div>
        </div>
      </nav>
    </header>

    <!-- Technical testing notice -->
    <section class="bg-black/80 border-y border-red-700/80 shadow-[0_0_40px_rgba(248,113,113,0.9)]">
      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-3">
        <div class="punk-card rounded-2xl border-2 border-red-600/90 bg-gradient-to-r from-red-900 via-black to-red-900 relative overflow-hidden">
          <div class="absolute inset-0 opacity-25 mix-blend-screen pointer-events-none"
               style="background-image: repeating-linear-gradient(-45deg, rgba(248,113,113,0.45) 0, rgba(248,113,113,0.45) 1px, transparent 1px, transparent 6px);"></div>
          <div class="relative flex flex-col sm:flex-row items-start sm:items-center gap-3 sm:gap-4">
            <div class="flex items-center gap-2">
              <span class="inline-flex items-center justify-center w-8 h-8 sm:w-9 sm:h-9 rounded-full bg-red-600 text-black font-extrabold text-lg shadow-[0_0_25px_rgba(248,113,113,1)] animate-pulse">
                !
              </span>
              <span class="px-2 py-0.5 rounded border border-red-400/70 text-[10px] uppercase tracking-[0.2em] text-red-200 bg-black/60">
                ВНИМАНИЕ
              </span>
            </div>
            <div class="text-[11px] sm:text-xs leading-relaxed text-red-100 font-semibold">
              <span class="block sm:inline">
                ФОРУМ НАХОДИТСЯ НА СТАДИИ ТЕХНИЧЕСКОГО ТЕСТИРОВАНИЯ,
              </span>
              <span class="block sm:inline sm:ml-1">
                ВОЗМОЖНЫ БУДУТ НАБЛЮДАТЬСЯ БАГИ.
              </span>
              <span class="block mt-1 text-red-300/90 text-[10px]">
                Если что-то ломается — не пугайся, это всего лишь панк-рок в бетe.
              </span>
              <span class="block mt-1 text-red-200 text-[10px] font-bold">
                Если нашёл баг — сообщи нам:
                <a href="https://vk.com/beaten_off_guys" target="_blank" rel="noopener noreferrer" class="underline underline-offset-2 decoration-red-400 hover:text-white hover:decoration-red-300">vk.com/beaten_off_guys</a>
              </span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Main layout -->
    <main class="flex-1">
      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-6 lg:py-8 grid grid-cols-1 lg:grid-cols-4 gap-6">
        <!-- Left column: categories -->
        <aside class="lg:col-span-1 space-y-4">
          <div class="punk-card rounded-2xl p-4">
            <div class="flex items-center justify-between mb-3">
              <h2 class="text-xs font-semibold uppercase tracking-[0.2em] text-slate-300">Секции шума</h2>
              <span class="text-[11px] text-slate-400">/категории</span>
            </div>
            <div class="space-y-2 text-xs">
              <button data-category="Общий ор" class="js-category-btn w-full flex items-center justify-between gap-3 px-2.5 py-2 rounded-xl bg-slate-900/90 border border-pink-500/70 text-pink-100 shadow-[0_0_20px_rgba(236,72,153,0.7)]">
                <div class="flex items-center gap-2">
                  <span class="w-1.5 h-6 bg-gradient-to-b from-pink-400 via-red-500 to-amber-400 rounded-full"></span>
                  <span class="font-semibold">Общий ор</span>
                </div>
                <span class="text-[10px] text-slate-300/80">0 тем</span>
              </button>

              <button data-category="Группы и релизы" class="js-category-btn w-full flex items-center justify-between gap-3 px-2.5 py-2 rounded-xl hover:bg-slate-900/80 border border-slate-600/70 text-slate-100">
                <div class="flex items-center gap-2">
                  <span class="w-1.5 h-6 bg-gradient-to-b from-emerald-400 to-lime-500 rounded-full"></span>
                  <span class="font-semibold">Группы и релизы</span>
                </div>
                <span class="text-[10px] text-slate-400">0 тем</span>
              </button>

              <button data-category="Инструменты и железо" class="js-category-btn w-full flex items-center justify-between gap-3 px-2.5 py-2 rounded-xl hover:bg-slate-900/80 border border-slate-600/70 text-slate-100">
                <div class="flex items-center gap-2">
                  <span class="w-1.5 h-6 bg-gradient-to-b from-sky-400 to-indigo-500 rounded-full"></span>
                  <span class="font-semibold">Инструменты и железо</span>
                </div>
                <span class="text-[10px] text-slate-400">0 тем</span>
              </button>

              <button data-category="Туровые байки" class="js-category-btn w-full flex items-center justify-between gap-3 px-2.5 py-2 rounded-xl hover:bg-slate-900/80 border border-slate-600/70 text-slate-100">
                <div class="flex items-center gap-2">
                  <span class="w-1.5 h-6 bg-gradient-to-b from-amber-300 to-rose-500 rounded-full"></span>
                  <span class="font-semibold">Туровые байки</span>
                </div>
                <span class="text-[10px] text-slate-400">0 тем</span>
              </button>

              <button data-category="DIY & околомузыка" class="js-category-btn w-full flex items-center justify-between gap-3 px-2.5 py-2 rounded-xl hover:bg-slate-900/80 border border-slate-600/70 text-slate-100">
                <div class="flex items-center gap-2">
                  <span class="w-1.5 h-6 bg-gradient-to-b from-fuchsia-400 to-pink-500 rounded-full"></span>
                  <span class="font-semibold">DIY & околомузыка</span>
                </div>
                <span class="text-[10px] text-slate-400">0 тем</span>
              </button>
            </div>
          </div>

          <div class="punk-card rounded-2xl p-4 text-xs">
            <div class="flex items-center justify-between mb-3">
              <h2 class="uppercase tracking-[0.2em] text-slate-300 font-semibold">Статистика хаоса</h2>
            </div>
            <dl class="space-y-2 text-slate-300/90">
              <div class="flex justify-between">
                <dt class="text-slate-400">Тем всего</dt>
                <dd class="font-semibold">0</dd>
              </div>
              <div class="flex justify-between">
                <dt class="text-slate-400">Сообщений</dt>
                <dd class="font-semibold">0</dd>
              </div>
              <div class="flex justify-between">
                <dt class="text-slate-400">Отбитых парней</dt>
                <dd class="font-semibold">0</dd>
              </div>
            </dl>
          </div>
        </aside>

        <!-- Center: threads -->
        <section id="threadsSection" class="lg:col-span-2 space-y-4">
          <div class="punk-card rounded-2xl p-4 sm:p-5 flex items-center justify-between gap-3">
            <div>
              <h2 class="uppercase tracking-[0.2em] text-xs text-slate-300 font-semibold flex items-center gap-1.5">
                Лента беспредела
                <span class="w-1 h-1 rounded-full bg-emerald-400 animate-pulse"></span>
              </h2>
              <p class="mt-1 text-xs text-slate-300/90">Свежие темы, горячие холивары и посты, за которые стыдно на утро.</p>
            </div>
            <div class="flex flex-col items-end gap-2 text-[11px]">
              <button id="filterHot" class="px-3 py-1 rounded-full bg-slate-900 border border-amber-400/60 text-amber-200 uppercase tracking-[0.16em] flex items-center gap-1">
                <span class="w-1.5 h-1.5 rounded-full bg-amber-400"></span>
                Горячее
              </button>
              <div class="flex items-center gap-1 text-slate-400">
                <span class="w-1 h-1 rounded-full bg-slate-500"></span>
                <span>Сортировка: <span id="sortLabel" class="text-slate-100">по шуму</span></span>
              </div>
            </div>
          </div>

          <div id="threadsList" class="space-y-3">
            <!-- Тем пока нет. Создай первую и запусти шум. -->
          </div>

          <!-- Empty state for when no threads match filter -->
          <div id="emptyState" class="punk-card-ghost rounded-2xl p-5 text-center text-xs text-slate-300/90">
            <div class="inline-flex items-center justify-center w-11 h-11 rounded-full border border-dashed border-slate-500/70 mb-2 bg-slate-900/70">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-5 h-5 text-slate-300/90">
                <path fill="currentColor" d="M12 2C8.1 2 5 5.1 5 9c0 5.2 7 13 7 13s7-7.8 7-13c0-3.9-3.1-7-7-7m0 9.5c-1.4 0-2.5-1.1-2.5-2.5S10.6 6.5 12 6.5s2.5 1.1 2.5 2.5S13.4 11.5 12 11.5" />
              </svg>
            </div>
            <p class="font-semibold mb-1">Тут пока тихо, даже соседи в шоке.</p>
            <p class="text-slate-400 mb-3">Сними ограничения или создай свою первую тему и устроим шум.</p>
            <button id="emptyNewThreadBtn" class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full bg-emerald-400 text-slate-950 font-semibold uppercase tracking-[0.16em] text-[11px]">
              Врубить новую тему
            </button>
          </div>
        </section>

        <!-- Right column: trending & rules -->
        <aside id="membersSection" class="lg:col-span-1 space-y-4">
          <div class="punk-card rounded-2xl p-4 text-xs">
            <h2 class="flex items-center justify-between mb-3">
              <span class="uppercase tracking-[0.2em] text-slate-300 font-semibold">Гул улиц</span>
              <span class="text-[11px] text-slate-400">/топ тем</span>
            </h2>
            <ul class="space-y-2">
            </ul>
          </div>

          <div class="punk-card rounded-2xl p-4 text-xs">
            <h2 class="flex items-center justify-between mb-3">
              <span class="uppercase tracking-[0.2em] text-slate-300 font-semibold">Правила погрома</span>
              <span class="text-[11px] text-slate-400">/прочитай</span>
            </h2>
            <ol class="space-y-1.5 text-slate-200">
              <li class="flex gap-2">
                <span class="text-pink-400 font-bold">01</span>
                <p class="flex-1">Не будь говнюком. Бесишь — улетаешь в бан быстрее, чем растёт бочку на разогреве.</p>
              </li>
              <li class="flex gap-2">
                <span class="text-pink-400 font-bold">02</span>
                <p class="flex-1">Никакого нацизма, сексизма и прочей токсичной фигни. Панк против системы, а не за угнетение.</p>
              </li>
              <li class="flex gap-2">
                <span class="text-pink-400 font-bold">03</span>
                <p class="flex-1">Реклама только в спецразделе. Остальное — в мусорку без объяснений.</p>
              </li>
              <li class="flex gap-2">
                <span class="text-pink-400 font-bold">04</span>
                <p class="flex-1">Спойлеры и NSFW помечаем. Мы отбитые, но не бессердечные.</p>
              </li>
            </ol>
          </div>

          <div class="punk-card rounded-2xl p-4 text-xs">
            <h2 class="flex items-center justify-between mb-3">
              <span class="uppercase tracking-[0.2em] text-slate-300 font-semibold">Новинки</span>
              <span class="text-[11px] text-slate-400">/свежая кровь</span>
            </h2>
            <p class="text-slate-400 text-[11px]">Пока никто не отписался. Будь первым, кто ввалится в подвал.</p>
          </div>

        </aside>
      </div>
    </main>

    <!-- Footer -->
    <footer class="border-t border-slate-800/80 bg-slate-950/90 mt-6">
      <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex flex-wrap items-center gap-3 justify-between text-[11px] text-slate-400">
        <div class="flex items-center gap-2">
          <span class="uppercase tracking-[0.2em] text-slate-300">Отбитые парни форум</span>
          <span class="w-px h-4 bg-slate-700"></span>
          <span>основан в подвале, обновлён в браузере</span>
        </div>
        <div class="flex flex-wrap items-center gap-3">
          <span>© <span id="year"></span> Шум. Сердца. Никаких лейблов.</span>
          <span class="w-px h-4 bg-slate-700 hidden sm:inline-block"></span>
          <a href="https://vk.com/beaten_off_guys" target="_blank" rel="noopener noreferrer" class="px-2 py-0.5 rounded-full bg-slate-900/90 border border-red-500/80 text-red-300 font-semibold shadow-[0_0_18px_rgba(239,68,68,0.9)] hover:bg-red-600 hover:text-slate-950 hover:shadow-[0_0_28px_rgba(239,68,68,1)] transition-colors">Сообщить о баге</a>
        </div>
      </div>
    </footer>
  </div>

  <!-- New Thread Modal -->
  <div id="newThreadModal" class="fixed inset-0 z-40 hidden items-center justify-center bg-black/70 backdrop-blur-sm">
    <div class="max-w-lg w-full mx-4 punk-card rounded-2xl p-4 sm:p-5 text-xs relative">
      <button id="closeModalBtn" class="absolute top-3 right-3 w-7 h-7 rounded-full bg-slate-900/90 border border-slate-700/80 flex items-center justify-center text-slate-300 hover:text-pink-300">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-4 h-4">
          <path fill="currentColor" d="m13.41 12l4.3-4.29l-1.42-1.42L12 10.59L7.71 6.29L6.29 7.71L10.59 12l-4.3 4.29l1.42 1.42L12 13.41l4.29 4.3l1.42-1.42z" />
        </svg>
      </button>
      <h2 class="punk-title text-sm text-slate-50 punk-outline mb-3 tracking-[0.3em]">НОВАЯ ТЕМА</h2>
      <p class="text-[11px] text-slate-300 mb-3">Напиши, что тебя бесит, радует или рвёт динамики. Остальное сделает форум.</p>
      <form id="newThreadForm" class="space-y-3">
        <div>
          <label for="threadTitle" class="block text-[11px] uppercase tracking-[0.16em] text-slate-300 mb-1">Заголовок</label>
          <input id="threadTitle" type="text" required maxlength="140" class="w-full rounded-xl bg-slate-950/80 border border-slate-700/80 px-3 py-2 text-xs text-slate-50 placeholder:text-slate-500 focus:outline-none focus:border-pink-500 focus:ring-1 focus:ring-pink-500" placeholder="Например: «Почему соседская группа играет лучше нас?»" />
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
          <div>
            <label for="threadCategory" class="block text-[11px] uppercase tracking-[0.16em] text-slate-300 mb-1">Категория</label>
            <select id="threadCategory" class="w-full rounded-xl bg-slate-950/80 border border-slate-700/80 px-3 py-2 text-xs text-slate-50 focus:outline-none focus:border-emerald-400 focus:ring-1 focus:ring-emerald-400">
              <option value="Общий ор">Общий ор</option>
              <option value="Группы и релизы">Группы и релизы</option>
              <option value="Инструменты и железо">Инструменты и железо</option>
              <option value="Туровые байки">Туровые байки</option>
              <option value="DIY & околомузыка">DIY & околомузыка</option>
            </select>
          </div>
          <div>
            <label for="threadTag" class="block text-[11px] uppercase tracking-[0.16em] text-slate-300 mb-1">Пометка</label>
            <input id="threadTag" type="text" maxlength="24" class="w-full rounded-xl bg-slate-950/80 border border-slate-700/80 px-3 py-2 text-xs text-slate-50 placeholder:text-slate-500 focus:outline-none focus:border-sky-400 focus:ring-1 focus:ring-sky-400" placeholder="холивар, вопрос, релиз..." />
          </div>
        </div>
        <div>
          <label for="threadContent" class="block text-[11px] uppercase tracking-[0.16em] text-slate-300 mb-1">Сообщение</label>
          <textarea id="threadContent" rows="4" required class="w-full rounded-xl bg-slate-950/80 border border-slate-700/80 px-3 py-2 text-xs text-slate-50 placeholder:text-slate-500 focus:outline-none focus:border-emerald-400 focus:ring-1 focus:ring-emerald-400" placeholder="Вали всё, что у тебя внутри. Но помни про правила погрома."></textarea>
        </div>
        <div class="flex flex-wrap items-center justify-between gap-3">
          <div class="flex items-center gap-1.5 text-[11px] text-slate-400">
            <input id="threadAnon" type="checkbox" class="rounded border-slate-600 bg-slate-900 text-pink-500 focus:ring-pink-500" />
            <label for="threadAnon">Пост анонимно (по кличке "Гость подвала")</label>
          </div>
          <button type="submit" class="inline-flex items-center gap-1.5 px-4 py-1.5 rounded-full bg-emerald-400 text-slate-950 font-semibold uppercase tracking-[0.18em] text-[11px] shadow-[0_0_22px_rgba(16,185,129,0.9)]">
            ВЫКРИКНУТЬ
          </button>
        </div>
      </form>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const body = document.body;
      const yearEl = document.getElementById("year");
      const themeToggle = document.getElementById("themeToggle");
      const onlineCounter = document.getElementById("onlineCounter");
      const filterHotBtn = document.getElementById("filterHot");
      const sortLabel = document.getElementById("sortLabel");
      const threadsList = document.getElementById("threadsList");
      const emptyState = document.getElementById("emptyState");
      const navHomeBtn = document.getElementById("navHomeBtn");
      const navThreadsBtn = document.getElementById("navThreadsBtn");
      const navMembersBtn = document.getElementById("navMembersBtn");
      const navAboutBtn = document.getElementById("navAboutBtn");
      const categoryButtons = Array.from(document.querySelectorAll(".js-category-btn"));

      const threadsSection = document.getElementById("threadsSection");
      const membersSection = document.getElementById("membersSection");
      const topBanner = document.querySelector("header");

      const newThreadBtn = document.getElementById("newThreadBtn");
      const emptyNewThreadBtn = document.getElementById("emptyNewThreadBtn");
      const newThreadModal = document.getElementById("newThreadModal");
      const closeModalBtn = document.getElementById("closeModalBtn");
      const newThreadForm = document.getElementById("newThreadForm");
      const threadTitleInput = document.getElementById("threadTitle");
      const threadCategorySelect = document.getElementById("threadCategory");
      const threadTagInput = document.getElementById("threadTag");
      const threadContentInput = document.getElementById("threadContent");
      const threadAnonCheckbox = document.getElementById("threadAnon");

      // Set current year
      if (yearEl) yearEl.textContent = new Date().getFullYear();

      // Play with online counter (subtle jitter)
      if (onlineCounter) {
        const base = parseInt(onlineCounter.textContent || "0", 10) || 143;
        setInterval(() => {
          const delta = Math.floor(Math.random() * 11) - 5; // -5..5
          const value = Math.max(3, base + delta);
          onlineCounter.textContent = value.toString();
        }, 7000);
      }

      // Theme toggle: switch between default neon background and darker minimal background
      if (themeToggle) {
        themeToggle.addEventListener("click", () => {
          const isDark = body.classList.toggle("bg-slate-950");
          body.style.background = isDark
            ? "#020617"
            : "radial-gradient(circle at 0% 0%, rgba(236,72,153,0.28), transparent 55%), radial-gradient(circle at 100% 100%, rgba(52,211,153,0.25), transparent 50%), radial-gradient(circle at 0% 100%, rgba(59,130,246,0.2), transparent 55%), #020617";
          sortLabel.classList.toggle("text-emerald-300");
        });
      }

      // Simple nav scroll behaviour
      const smoothScrollTo = (el) => {
        if (!el) return;
        const headerOffset = topBanner ? topBanner.offsetHeight + 12 : 80;
        const rect = el.getBoundingClientRect();
        const offset = rect.top + window.scrollY - headerOffset;
        window.scrollTo({ top: offset, behavior: "smooth" });
      };

      if (navHomeBtn) {
        navHomeBtn.addEventListener("click", () => {
          window.scrollTo({ top: 0, behavior: "smooth" });
        });
      }

      if (navThreadsBtn && threadsSection) {
        navThreadsBtn.addEventListener("click", () => {
          smoothScrollTo(threadsSection);
        });
      }

      if (navMembersBtn && membersSection) {
        navMembersBtn.addEventListener("click", () => {
          smoothScrollTo(membersSection);
        });
      }

      if (navAboutBtn) {
        navAboutBtn.addEventListener("click", () => {
          smoothScrollTo(document.body);
        });
      }

      // Filters: hot + by category
      let showOnlyHot = false;
      let activeCategory = null;

      const applyFilters = () => {
        if (!threadsList || !emptyState) return;
        const items = Array.from(threadsList.querySelectorAll("article"));
        let visibleCount = 0;
        items.forEach((item) => {
          const isHot = item.getAttribute("data-hot") === "1";
          const category = item.getAttribute("data-category");
          const matchHot = !showOnlyHot || isHot;
          const matchCategory = !activeCategory || category === activeCategory;
          const shouldShow = matchHot && matchCategory;
          item.classList.toggle("hidden", !shouldShow);
          if (shouldShow) visibleCount++;
        });
        emptyState.classList.toggle("hidden", visibleCount > 0);
      };

      if (filterHotBtn) {
        filterHotBtn.addEventListener("click", () => {
          showOnlyHot = !showOnlyHot;
          filterHotBtn.classList.toggle("bg-amber-400", showOnlyHot);
          filterHotBtn.classList.toggle("border-amber-400/60", showOnlyHot);
          filterHotBtn.classList.toggle("text-slate-950", showOnlyHot);
          filterHotBtn.classList.toggle("bg-slate-900", !showOnlyHot);
          filterHotBtn.classList.toggle("text-amber-200", !showOnlyHot);
          sortLabel.textContent = showOnlyHot ? "жарке" : "по шуму";
          applyFilters();
        });
      }

      if (categoryButtons.length) {
        categoryButtons.forEach((btn) => {
          btn.addEventListener("click", () => {
            const cat = btn.getAttribute("data-category") || null;
            // Toggle off if clicking the same category
            activeCategory = activeCategory === cat ? null : cat;

            categoryButtons.forEach((b) => {
              const bCat = b.getAttribute("data-category");
              b.classList.toggle("js-category-btn-active", !!activeCategory && bCat === activeCategory);
            });

            applyFilters();
            if (threadsSection) smoothScrollTo(threadsSection);
          });
        });
      }

      // Modal controls
      const openModal = () => {
        if (!newThreadModal) return;
        newThreadModal.classList.remove("hidden");
        newThreadModal.classList.add("flex");
        setTimeout(() => threadTitleInput && threadTitleInput.focus(), 100);
      };

      const closeModal = () => {
        if (!newThreadModal) return;
        newThreadModal.classList.add("hidden");
        newThreadModal.classList.remove("flex");
        newThreadForm && newThreadForm.reset();
      };

      if (newThreadBtn) newThreadBtn.addEventListener("click", openModal);
      if (emptyNewThreadBtn) emptyNewThreadBtn.addEventListener("click", openModal);
      if (closeModalBtn) closeModalBtn.addEventListener("click", closeModal);
      if (newThreadModal) {
        newThreadModal.addEventListener("click", (e) => {
          if (e.target === newThreadModal) closeModal();
        });
      }

      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") closeModal();
      });

      // Thread creation (front-end only)
      if (newThreadForm && threadsList) {
        newThreadForm.addEventListener("submit", (e) => {
          e.preventDefault();
          const title = (threadTitleInput && threadTitleInput.value.trim()) || "Без названия, но с шумом";
          const category = threadCategorySelect ? threadCategorySelect.value : "Общий ор";
          const tag = (threadTagInput && threadTagInput.value.trim()) || "свежак";
          const content = (threadContentInput && threadContentInput.value.trim()) || "";
          const isAnon = threadAnonCheckbox && threadAnonCheckbox.checked;

          const author = isAnon ? "Гость подвала" : "ты";
          const now = new Date();
          const pad = (n) => (n < 10 ? "0" + n : n);
          const time = `${pad(now.getHours())}:${pad(now.getMinutes())}`;

          const article = document.createElement("article");
          article.className = "punk-card rounded-2xl px-3.5 py-3 sm:px-4 sm:py-4 text-xs";
          article.setAttribute("data-hot", "1");

          article.innerHTML = `
            <div class="flex flex-wrap items-start gap-3">
              <div class="flex flex-col items-center pt-0.5">
                <button class="group flex flex-col items-center" data-action="like">
                  <span class="w-8 h-8 rounded-full border border-emerald-400/70 flex items-center justify-center bg-emerald-400/30 group-hover:bg-emerald-400/50 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-4 h-4 text-emerald-300">
                      <path fill="currentColor" d="M5 21h2V9H5zm14-11h-5.31l.95-4.57L14 4l-4 5v10h7.39l1.37-8.2L19 10" />
                    </svg>
                  </span>
                  <span class="mt-1 font-semibold text-emerald-300" data-like-count>1</span>
                </button>
              </div>
              <div class="flex-1 min-w-[0]">
                <header class="flex flex-wrap items-start gap-2 justify-between">
                  <div class="min-w-0">
                    <div class="inline-flex items-center gap-1.5 mb-1">
                      <span class="px-2 py-0.5 rounded-full text-[10px] uppercase tracking-[0.18em] bg-pink-600/20 text-pink-200 border border-pink-500/60">
                        ${category}
                      </span>
                      <span class="px-2 py-0.5 rounded-full text-[10px] uppercase tracking-[0.18em] bg-slate-900/80 text-slate-200 border border-slate-600/70">
                        ${tag || "свежак"}
                      </span>
                    </div>
                    <h3 class="text-sm sm:text-[15px] font-semibold text-slate-50">
                      ${title.replace(/</g, "&lt;")}
                    </h3>
                  </div>
                  <div class="text-[11px] text-right text-slate-400">
                    <div>Сейчас, ${time}</div>
                    <div>от <span class="text-pink-300 font-semibold">${author}</span></div>
                  </div>
                </header>
                <p class="mt-1.5 text-[11px] sm:text-xs text-slate-200/90 whitespace-pre-wrap">
                  ${content.replace(/</g, "&lt;")}
                </p>
                <footer class="mt-2 flex flex-wrap items-center gap-3 justify-between">
                  <div class="flex flex-wrap items-center gap-1.5 text-[11px] text-slate-400">
                    <span class="inline-flex items-center gap-1 px-1.5 py-0.5 rounded-full bg-slate-900/70 border border-slate-700/80">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-3 h-3 text-sky-300">
                        <path fill="currentColor" d="m15.5 5.5l-6 6l-3-3L5 9l4.5 4.5l7-7z" />
                      </svg>
                      0 ответов
                    </span>
                    <span class="inline-flex items-center gap-1 px-1.5 py-0.5 rounded-full bg-slate-900/70">
                      <span class="w-1.5 h-1.5 rounded-full bg-emerald-400"></span>
                      новая тема
                    </span>
                  </div>
                  <button data-action="toggle-replies" class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full bg-slate-900/80 text-slate-200 border border-slate-700/80 text-[11px]">
                    Ответить первым
                  </button>
                </footer>
                <div class="mt-2 hidden border-t border-slate-700/70 pt-2 space-y-1.5 text-[11px] text-slate-300" data-replies>
                  <p class="text-slate-500">Пока нет ответов. Стань первым, кто врубится.</p>
                </div>
              </div>
            </div>
          `;

          threadsList.prepend(article);

          // Hide empty state if it was visible
          if (emptyState) emptyState.classList.add("hidden");

          closeModal();
        });
      }

      // Delegated events for likes and reply toggles
      document.addEventListener("click", (e) => {
        const target = e.target;
        if (!(target instanceof HTMLElement)) return;

        const likeButton = target.closest("[data-action=like]");
        if (likeButton) {
          const counterEl = likeButton.querySelector("[data-like-count]");
          if (counterEl) {
            const current = parseInt(counterEl.textContent || "0", 10) || 0;
            counterEl.textContent = String(current + 1);
          }
          return;
        }

        const toggleRepliesBtn = target.closest("[data-action=toggle-replies]");
        if (toggleRepliesBtn) {
          const article = toggleRepliesBtn.closest("article");
          if (!article) return;
          const replies = article.querySelector("[data-replies]");
          if (!replies) return;
          const isHidden = replies.classList.contains("hidden");
          replies.classList.toggle("hidden", !isHidden);
          toggleRepliesBtn.textContent = isHidden ? "Спрятать ответы" : "Показать пару ответов";
        }
      });
    });
  </script>
</body>
</html>
